name: CI Tests

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  test:
    name: Test on Node.js ${{ matrix.node-version }}
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [18.x, 20.x]
      fail-fast: false  # í•˜ë‚˜ ì‹¤íŒ¨í•´ë„ ë‹¤ë¥¸ ë²„ì „ ê³„ì† í…ŒìŠ¤íŠ¸
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v6
    
    - name: ðŸ“¦ Setup pnpm
      uses: pnpm/action-setup@v4
      with:
        version: 10
    
    - name: ðŸŸ¢ Setup Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'pnpm'
    
    - name: ðŸ“š Install dependencies
      run: pnpm install --frozen-lockfile
    
    - name: ðŸ§ª Run tests
      run: pnpm test:run
    
    - name: ðŸ“Š Test Summary
      if: always()
      run: |
        echo "### Test Results ðŸ§ª" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "âœ… Tests completed on Node.js ${{ matrix.node-version }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Branch:** ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
        echo "**Commit:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
